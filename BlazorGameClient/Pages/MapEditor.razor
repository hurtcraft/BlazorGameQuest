@page "/MapEditor"
@using Blazor.Extensions
@using Blazor.Extensions.Canvas
@using Blazor.Extensions.Canvas.Canvas2D
@using BlazorGameQuestClassLib
@using BlazorGameClient.Components.GamePlay
@inject HttpClient Http

@* <div style="display:inline-block; position:relative;" @onmousemove="OnMouseMove" @onclick="OnMouseClick">
    <AdminNavbar />
    
    <GridCanva/>


</div> *@
<div style="display:flex; height:100vh;">
    <AdminNavbar />

    <div
        style="flex:1; padding: 5rem; overflow:auto; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <h1 style="margin-bottom:2rem;">Map Editor en construction</h1>
        <GridCanva @ref="GridCanvaRef" gameGrid="@gameGrid" IsEditing=true />
    </div>
    <MapEditorTools donjon="@donjon" OnDonjonSelected="HandleDonjonSelected" />

</div>

@code {

    private GameGrid gameGrid = new GameGrid();
    private GridCanva? GridCanvaRef;

    private Donjon? donjon;

    private int _mouseX;
    private int _mouseY;

private async Task HandleDonjonSelected(Donjon loadedDonjon)
{
    donjon = loadedDonjon;
    Console.WriteLine("mon donjon "+donjon);
    if (donjon.GameGrid != null && GridCanvaRef!=null)
    {
        await GridCanvaRef.DrawFromGameGrid(donjon.GameGrid);
    }
}
    private void OnMouseMove(MouseEventArgs e)
    {
        // inversion pour la coh√©rence de la matrice grid
        _mouseX = (int)(e.OffsetY / GameGrid.SPRITE_SIZE);
        _mouseY = (int)(e.OffsetX / GameGrid.SPRITE_SIZE);
        //Console.WriteLine($"Cellule : {cellX}, {cellY}");
    }
    protected override void OnInitialized()
    {
        donjon = new Donjon
        {
            Id = 12345,
            Name = "donjon1",
            GameGrid = gameGrid
        };
    }

    private void OnMouseClick(MouseEventArgs e)
    {
        Console.WriteLine($"Cellule : {_mouseX}, {_mouseY}");
    }


}